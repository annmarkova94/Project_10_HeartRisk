# Предсказание риска сердечного приступа

## Описание проекта
Проект реализует модель машинного обучения для предсказания риска сердечного приступа на основе данных пациента (антропометрические показатели, привычки, давление и ритм, история болезни, биохимия крови).  
Модель обучена на предоставленном тренировочном датасете и может делать предсказания на новых данных через библиотеку Python или FastAPI приложение.

---

## Стек технологий
- Python 3.9+
- Pandas, NumPy
- Scikit-learn
- CatBoost
- FastAPI
- HTML (для веб-интерфейса)

---

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/<ваш-репозиторий>/project_M1.git
cd project_M1
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate       # Linux/Mac
venv\Scripts\activate          # Windows
pip install -r requirements.txt
```

## Структура проекта
```
Project_10_HeartRisk/  
├──_ app/  
│   ├── main.py                   # Приложение  
│   ├── model.py                  # Класс модели HeartRiskModel  
│   ├── model_with_threshold.pkl  # Сохраненный словарь с обученной моделью и порогом  
│   └── utils.py                  # Дополнительные функции  
├── notebooks/                    # Исследования и эксперименты  
│   └── exploration.ipynb  
├── predictions/                  # Предсказания на тестовом датасете  
│   └── predictions.csv  
├── sample_inputs/                # Примеры файлов для загрузки  
│   ├── sample_input_type1.xlsx  
│   └── sample_input_type2.csv 
├── templates/                    # HTML формы  
│   └── home_form.html    
├── requirements.txt  
└── README.md                     # Документация
```

## Использование
1. Запускаем приложение main.py
2. Открываем браузер http://127.0.0.1:8000/
2. Выбираем файл на компьютере. Требования к файлу загрузки:
    - формат `.xls`/`.xlsx` или `.csv`
    - 25 столбцов-признаков (см примеры файлов и название признаков в папке `sample_inputs`)
    - 2 строки: название признаков, значения признаков для конкретного пациента  
   Пример файла:
   ```
    age,gender,obesity,bmi,income,smoking,alc,exercise_hpw
    0.7,1.0,1.0,0.8,0.8,1.0,1.0,0.1
   ```
3. Отправляем файл. Результат предсказания появится на экране  
    Пример вывода:
    ```
    Риск сердечного приступа оценивается в 73 условных процентных пункта.
    По текущему порогу (0.2) риск считается высоким.
   ```
   
## Классы
### `HeartRiskModel`
Класс для загрузки обученной модели и предсказания риска сердечного приступа.  
Модель загружается автоматически при запуске приложения (`HeartRiskModel` в `model.py`).   

Метод:
- `predict_risk(X: pd.DataFrame) -> dict` делает предсказание для нового набора данных X по одному пациенту. Возвращает словарь с ключами:
  - `threshold` — используемый порог для классификации
  - `risk_prob` — вероятность высокого риска (float от 0 до 1)
  - `risk_bool` — логическое значение (True, если риск выше порога, иначе False)

## API endpoints
Swagger UI доступен по адресу http://127.0.0.1:8000/docs.

### `GET /`
Главная страница с HTML-формой для загрузки файла пациента.

### `POST /upload`
Принимает файл (`.csv`, `.xls`, `.xlsx`) с данными пациента.  
Возвращает HTML-страницу с результатом предсказания (вероятность риска и классификация по порогу).


## Примечания
- Модель не обучается в коде приложения, только загружается из файла.
- Все предсказания делаются через метод `predict_risk`.
- HTML-шаблоны находятся в папке `templates/` и используются для формы загрузки.
- Исследования и эксперименты с моделью находятся в `notebooks/`.